package io.github.lefraudeur.modules.exploit;

import io.github.lefraudeur.events.PreTickEvent;
import io.github.lefraudeur.gui.settings.types.ModeSetting;
import io.github.lefraudeur.modules.Category;
import io.github.lefraudeur.modules.Info;
import io.github.lefraudeur.modules.Module;
import io.github.lefraudeur.utils.BlockUtils;
import io.github.lefraudeur.utils.player.RotationUtils;
import net.minecraft.item.BlockItem;
import net.minecraft.network.packet.c2s.play.PlayerInteractBlockC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;
import net.minecraft.util.Hand;
import net.minecraft.util.hit.BlockHitResult;
import net.minecraft.util.math.Direction;
import net.minecraft.util.math.Vec3d;

@Info(category = Category.EXPLOIT, name = "Disabler",  description = "Disables anticheats", key = Module.key_none)
public final class Disabler extends Module {

	public Disabler() { super(); }

	public static boolean fail = false;
	public static boolean enabled = false;

	private final ModeSetting mode = new ModeSetting("Mode", "What mode should disabler use.", "Vulcan");

	@Override
	protected void onEnable() {
		fail = false;
		enabled = true;
	}

	@Override
	protected void onDisable() {
		enabled = false;
	}

	@Override
	public void onPreTickEvent(PreTickEvent event) {
		if (isNull()) return;
		switch (mode.get()) {
			case "Vulcan" -> {
				if (mc.player.getInventory().getMainHandStack().getItem() instanceof BlockItem && !BlockUtils.cantBePlacedOn(mc.world.getBlockState(mc.player.getBlockPos().down()).getBlock())) {
					fail = false;
					Direction side = Direction.DOWN;
					Vec3d vec = Vec3d.ofCenter(mc.player.getBlockPos());
					vec = vec.add((float) side.getOffsetX() * 0.5, (float) side.getOffsetY() * 0.5, (float) side.getOffsetZ() * 0.5);
					BlockHitResult bhr = new BlockHitResult(vec, side.getOpposite(), mc.player.getBlockPos().down(), false);
                    mc.getNetworkHandler().sendPacket(new PlayerMoveC2SPacket.Full(mc.player.getX(), mc.player.getY(), mc.player.getZ(), (float) RotationUtils.getYaw(vec), (float) RotationUtils.getPitch(vec), mc.player.isOnGround()));
                    send(new PlayerInteractBlockC2SPacket(Hand.MAIN_HAND, bhr, 0));
                    mc.getNetworkHandler().sendPacket(new PlayerMoveC2SPacket.Full(mc.player.getX(), mc.player.getY(), mc.player.getZ(), mc.player.getYaw(), mc.player.getPitch(), mc.player.isOnGround()));
				} else if (mc.player.age % 40 == 0) {
					message("Hold a block in your hand to use disabler!");
					fail = true;
				}
			}
		}
	}
}
